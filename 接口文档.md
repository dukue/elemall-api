# 电商后台管理系统 API 文档

## 基础说明

- 基础URL: `http://localhost:3000/api/v1`
- 请求头: 
  ```
  Content-Type: application/json
  Authorization: Bearer <token>  // 除登录接口外都需要
  ```
- 响应格式:
  ```json
  {
    "code": 200,      // 状态码：200成功，400请求错误，401未授权，500服务器错误
    "message": "xxx", // 响应信息
    "data": {}       // 响应数据
  }
  ```

## 1. 用户认证

### 1.1 登录
- 请求路径：`/auth/login`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "username": "admin",
    "password": "123456"
  }
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "token": "xxx.xxx.xxx",
      "userInfo": {
        "id": 1,
        "username": "admin",
        "role": "admin",
        "avatar": "url"
      }
    }
  }
  ```

### 1.2 退出登录
- 请求路径：`/auth/logout`
- 请求方法：POST
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "退出成功"
  }
  ```

## 2. 用户管理

### 2.1 获取用户列表
- 请求路径：`/users`
- 请求方法：GET
- 请求参数：
  ```
  query    // 搜索关键词，可选
  pagenum  // 当前页码
  pagesize // 每页数量
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "data": {
      "total": 100,
      "users": [
        {
          "id": 1,
          "username": "admin",
          "email": "admin@test.com",
          "mobile": "13800138000",
          "role": "admin",
          "status": true,
          "createTime": "2024-03-15 10:00:00"
        }
      ]
    }
  }
  ```

### 2.2 添加用户
- 请求路径：`/users`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "username": "test",
    "password": "123456",
    "email": "test@test.com",
    "mobile": "13800138000",
    "role": "user"
  }
  ```

### 2.3 修改用户
- 请求路径：`/users/:id`
- 请求方法：PUT
- 请求参数：
  ```json
  {
    "email": "new@test.com",
    "mobile": "13800138001",
    "role": "admin"
  }
  ```

### 2.4 删除用户
- 请求路径：`/users/:id`
- 请求方法：DELETE

## 3. 商品管理

### 3.1 获取商品列表
- 请求路径：`/products`
- 请求方法：GET
- 请求参数：
  ```
  query    // 搜索关键词
  pagenum  // 当前页码
  pagesize // 每页数量
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "data": {
      "total": 100,
      "products": [
        {
          "id": 1,
          "name": "商品1",
          "price": 99.99,
          "weight": 1.5,
          "status": true,
          "description": "商品描述",
          "createTime": "2024-03-15 10:00:00"
        }
      ]
    }
  }
  ```

### 3.2 添加商品
- 请求路径：`/products`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "name": "商品名称",
    "price": 99.99,
    "weight": 1.5,
    "description": "商品描述"
  }
  ```

### 3.3 修改商品
- 请求路径：`/products/:id`
- 请求方法：PUT
- 请求参数：同添加商品

### 3.4 删除商品
- 请求路径：`/products/:id`
- 请求方法：DELETE

### 3.5 更新商品状态
- 请求路径：`/products/:id/status`
- 请求方法：PUT
- 请求参数：
  ```json
  {
    "status": true  // true启用，false禁用
  }
  ```

### 3.6 补充

1. 上传商品主图：
```http
POST /products/:id/image
Content-Type: multipart/form-data

file: (图片文件)
```

2. 上传商品图片集：
```http
POST /products/:id/images
Content-Type: multipart/form-data

images: (图片文件1)
images: (图片文件2)
...
```

上传成功后，图片将保存在服务器的 `uploads/products` 目录下，并可以通过 `/uploads/products/filename.jpg` 这样的URL访问。

## 4. 订单管理

### 4.1 获取订单列表
- 请求路径：`/orders`
- 请求方法：GET
- 请求参数：
  ```
  query      // 订单号
  startDate  // 开始日期
  endDate    // 结束日期
  pagenum    // 当前页码
  pagesize   // 每页数量
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "data": {
      "total": 100,
      "orders": [
        {
          "id": 1,
          "orderNo": "ORDER202403150001",
          "createTime": "2024-03-15 10:30:00",
          "totalAmount": 299.99,
          "status": "pending",
          "payMethod": "alipay",
          "receiver": "张三",
          "phone": "13800138000",
          "address": "北京市朝阳区xxx",
          "products": [
            {
              "name": "商品1",
              "price": 99.99,
              "quantity": 2
            }
          ]
        }
      ]
    }
  }
  ```

### 4.2 更新订单状态
- 请求路径：`/orders/:id/status`
- 请求方法：PUT
- 请求参数：
  ```json
  {
    "status": "processing"  // pending待发货，processing已发货，completed已完成，cancelled已取消
  }
  ```

## 5. 数据统计

### 5.1 获取概览数据
- 请求路径：`/statistics/overview`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "data": {
      "totalSales": 126560,
      "totalOrders": 1280,
      "totalProducts": 358,
      "totalUsers": 2856,
      "trends": {
        "sales": 12.5,
        "orders": -2.8,
        "products": 8.2,
        "users": 15.3
      }
    }
  }
  ```

### 5.2 获取销售趋势
- 请求路径：`/statistics/sales`
- 请求方法：GET
- 请求参数：
  ```
  range  // week本周，month本月，year本年
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "data": {
      "xAxis": ["周一", "周二", "周三", "周四", "周五", "周六", "周日"],
      "series": [820, 932, 901, 934, 1290, 1330, 1320]
    }
  }
  ```

### 5.3 获取商品分类统计
- 请求路径：`/statistics/categories`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "data": [
      { "name": "电子产品", "value": 1048 },
      { "name": "服装", "value": 735 },
      { "name": "食品", "value": 580 },
      { "name": "家居", "value": 484 },
      { "name": "其他", "value": 300 }
    ]
  }
  ```

### 5.4 获取支付方式统计
- 请求路径：`/statistics/payments`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "data": [
      { "name": "支付宝", "value": 1048 },
      { "name": "微信支付", "value": 735 },
      { "name": "银行卡", "value": 580 }
    ]
  }
  ```

## 6. 文件上传

### 6.1 临时文件上传
- 请求路径：`/upload/temp-upload`
- 请求方法：POST
- 请求头：`Content-Type: multipart/form-data`
- 请求参数：
  ```
  file: (图片文件)  // 只支持图片格式，大小限制5MB
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "文件上传成功",
    "data": {
      "filename": "1234567890-123456789.jpg",
      "path": "uploads/temp/1234567890-123456789.jpg",
      "mimetype": "image/jpeg",
      "size": 1024
    }
  }
  ```

## 7. 清关管理

### 7.1 获取清关状态
- 请求路径：`/orders/:id/customs`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取清关状态成功",
    "data": {
      "id": 1,
      "orderId": "123",
      "status": "pending",
      "customsNo": "CUS202403150001",
      "declarationDate": "2024-03-15 10:00:00",
      "clearanceDate": null,
      "notes": "等待海关审核"
    }
  }
  ```

### 7.2 获取清关文件列表
- 请求路径：`/orders/:id/customs/documents`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取清关文件成功",
    "data": [
      {
        "id": 1,
        "type": "invoice",
        "name": "发票.pdf",
        "path": "uploads/customs/file1.pdf",
        "uploadTime": "2024-03-15 10:00:00"
      }
    ]
  }
  ```

### 7.3 上传清关文件
- 请求路径：`/orders/:id/customs/documents`
- 请求方法：POST
- 请求头：`Content-Type: multipart/form-data`
- 请求参数：
  ```
  file: (文件)
  type: "invoice" | "packing_list" | "declaration" | "inspection_cert" | "other"
  name: "文件名称"
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "上传清关文件成功",
    "data": {
      "id": 1,
      "type": "invoice",
      "name": "发票.pdf",
      "path": "uploads/customs/file1.pdf"
    }
  }
  ```

### 7.4 下载清关文件
- 请求路径：`/orders/:id/customs/documents/:documentId`
- 请求方法：GET
- 响应：文件下载流

## 8. 仓库管理

### 8.1 获取仓库列表
- 请求路径：`/warehouses`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取仓库列表成功",
    "data": [
      {
        "id": 1,
        "code": "WH001",
        "name": "主仓库",
        "location": "北京市朝阳区xxx",
        "country": "CN",
        "contact": "张三",
        "phone": "13800138000",
        "isActive": true
      }
    ]
  }
  ```

### 8.2 创建仓库
- 请求路径：`/warehouses`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "code": "WH001",      // 仓库代码，3-20位大写字母或数字
    "name": "主仓库",     // 仓库名称，2-100字符
    "location": "地址",   // 仓库地址，5-200字符
    "country": "CN",      // 国家代码，2位大写字母(ISO 3166-1)
    "contact": "张三",    // 联系人，可选，2-50字符
    "phone": "13800138000" // 电话，可选，5-20位数字/横线/空格
  }
  ```

### 8.3 更新仓库
- 请求路径：`/warehouses/:id`
- 请求方法：PUT
- 请求参数：同创建仓库，但code不可修改

## 9. 汇率管理

### 9.1 获取汇率列表
- 请求路径：`/exchange/rates`
- 请求方法：GET
- 请求参数：
  ```
  query  // 搜索关键词，可选，匹配货币代码
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取汇率列表成功",
    "data": [
      {
        "fromCurrency": "USD",
        "toCurrency": "CNY",
        "rate": 6.45,
        "updateTime": "2024-03-15 10:00:00"
      }
    ]
  }
  ```

## 10. 物流统计

### 10.1 获取物流时效统计
- 请求路径：`/statistics/logistics/time`
- 请求方法：GET
- 请求参数：
  ```
  startDate  // 开始日期，可选
  endDate    // 结束日期，可选
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取物流时效统计成功",
    "data": [
      {
        "country": "US",
        "carrier": "DHL",
        "shipmentCount": 100,
        "avgDeliveryDays": 5.5
      }
    ]
  }
  ```

### 10.2 获取承运商绩效统计
- 请求路径：`/statistics/logistics/performance`
- 请求方法：GET
- 请求参数：
  ```
  startDate  // 开始日期，可选
  endDate    // 结束日期，可选
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取承运商绩效统计成功",
    "data": [
      {
        "carrier": "DHL",
        "totalShipments": 1000,
        "deliveredCount": 950,
        "exceptionCount": 30,
        "returnedCount": 20,
        "deliveryRate": 95.0,
        "exceptionRate": 3.0,
        "returnRate": 2.0
      }
    ]
  }
  ```

## 11. 物流管理

### 11.1 获取订单物流信息
- 请求路径：`/orders/:orderId/tracking`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取物流信息成功",
    "data": {
      "id": 1,
      "orderId": "123",
      "trackingNo": "TN1735840566070882",
      "carrier": "DHL",
      "status": "in_transit",
      "estimatedDelivery": "2024-03-20",
      "originCountry": "CN",
      "destinationCountry": "US",
      "createTime": "2024-03-15 10:00:00",
      "updateTime": "2024-03-15 10:00:00"
    }
  }
  ```

### 11.2 创建物流追踪
- 请求路径：`/orders/:orderId/tracking`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "trackingNo": "TN1735840566070882",
    "carrier": "DHL",
    "estimatedDelivery": "2024-03-20",
    "originCountry": "CN",
    "destinationCountry": "US"
  }
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "创建物流追踪成功",
    "data": {
      "id": 1,
      "trackingNo": "TN1735840566070882",
      "status": "pending"
    }
  }
  ```

### 11.3 更新物流状态
- 请求路径：`/orders/:orderId/tracking/:trackingNo`
- 请求方法：PUT
- 请求参数：
  ```json
  {
    "status": "in_transit",
    "location": "广州海关",
    "details": "包裹正在清关中"
  }
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "更新物流状态成功"
  }
  ```

### 11.4 获取物流历史记录
- 请求路径：`/orders/:orderId/tracking/history`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取物流历史记录成功",
    "data": [
      {
        "id": 1,
        "location": "广州海关",
        "status": "in_transit",
        "details": "包裹正在清关中",
        "eventTime": "2024-03-15 10:00:00"
      },
      {
        "id": 2,
        "location": "深圳集散中心",
        "status": "in_transit", 
        "details": "包裹已到达集散中心",
        "eventTime": "2024-03-15 09:00:00"
      }
    ]
  }
  ```

### 11.5 物流状态说明
状态枚举值：
- pending: 待发货
- picked_up: 已取件
- in_transit: 运输中
- customs: 清关中
- out_for_delivery: 派送中
- delivered: 已送达
- exception: 异常
- returned: 已退回

## 错误码说明

- 200: 成功
- 400: 请求参数错误
- 401: 未授权或token过期
- 403: 权限不足
- 404: 资源不存在
- 500: 服务器内部错误

## 注意事项

1. 所有需要鉴权的接口都需要在请求头中携带token
2. 分页接口的pagenum从1开始
3. 时间格式统一使用：YYYY-MM-DD HH:mm:ss
4. 金额单位为元，保留两位小数
5. 所有的删除操作都是软删除
6. 文件上传大小限制：
   - 临时文件：5MB
   - 商品图片：5MB
   - 清关文件：10MB
7. 支持的图片格式：jpg、jpeg、png、gif
8. 文件访问路径：
   - 临时文件：/uploads/temp/
   - 商品图片：/uploads/products/
   - 清关文件：/uploads/customs/

## 12. 前台商城接口

### 12.1 商品展示

#### 12.1.1 获取商品分类列表
- 请求路径：`/mall/categories`
- 请求方法：GET
- 请求参数：
  ```
  lang   // 语言代码，默认zh
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取分类列表成功",
    "data": [
      {
        "id": 1,
        "name": "电子产品",
        "description": "数码电子产品分类",
        "image": "url",
        "children": [
          {
            "id": 2,
            "name": "手机",
            "description": "智能手机分类",
            "image": "url"
          }
        ]
      }
    ]
  }
  ```

#### 12.1.2 获取商品列表
- 请求路径：`/mall/products`
- 请求方法：GET
- 请求参数：
  ```
  categoryId  // 分类ID，可选
  query       // 搜索关键词，可选
  sort        // 排序方式：price_asc/price_desc/sales_desc/new，可选
  minPrice    // 最低价格，可选
  maxPrice    // 最高价格，可选
  pagenum     // 当前页码
  pagesize    // 每页数量
  lang        // 语言代码，默认zh
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取商品列表成功",
    "data": {
      "total": 100,
      "products": [
        {
          "id": 1,
          "name": "商品名称",
          "price": 99.99,
          "originalPrice": 199.99,
          "description": "商品描述",
          "mainImage": "url",
          "images": ["url1", "url2"],
          "sales": 1000,
          "rating": 4.8,
          "reviewCount": 500
        }
      ]
    }
  }
  ```

#### 12.1.3 获取商品详情
- 请求路径：`/mall/products/:id`
- 请求方法：GET
- 请求参数：
  ```
  lang   // 语言代码，默认zh
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取商品详情成功",
    "data": {
      "id": 1,
      "name": "商品名称",
      "price": 99.99,
      "originalPrice": 199.99,
      "description": "商品详细描述",
      "mainImage": "url",
      "images": ["url1", "url2"],
      "specifications": {
        "颜色": ["红色", "蓝色"],
        "尺寸": ["S", "M", "L"]
      },
      "sales": 1000,
      "rating": 4.8,
      "reviewCount": 500,
      "stock": 100,
      "category": {
        "id": 1,
        "name": "分类名称"
      }
    }
  }
  ```

### 12.2 购物车

#### 12.2.1 获取购物车列表
- 请求路径：`/mall/cart`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取购物车成功",
    "data": {
      "items": [
        {
          "id": 1,
          "productId": 1,
          "name": "商品名称",
          "price": 99.99,
          "quantity": 2,
          "image": "url",
          "selected": true,
          "stock": 100,
          "specifications": {
            "颜色": "红色",
            "尺寸": "M"
          }
        }
      ],
      "totalAmount": 199.98,
      "totalQuantity": 2
    }
  }
  ```

#### 12.2.2 添加商品到购物车
- 请求路径：`/mall/cart`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "productId": 1,
    "quantity": 2,
    "specifications": {
      "颜色": "红色",
      "尺寸": "M"
    }
  }
  ```

#### 12.2.3 更新购物车商品数量
- 请求路径：`/mall/cart/:itemId`
- 请求方法：PUT
- 请求参数：
  ```json
  {
    "quantity": 3
  }
  ```

#### 12.2.4 删除购物车商品
- 请求路径：`/mall/cart/:itemId`
- 请求方法：DELETE

#### 12.2.5 更新商品选中状态
- 请求路径：`/mall/cart/select`
- 请求方法：PUT
- 请求参数：
  ```json
  {
    "itemIds": [1, 2],
    "selected": true
  }
  ```

### 12.3 用户中心

#### 12.3.1 用户注册
- 请求路径：`/mall/user/register`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "username": "user123",
    "password": "password123",
    "email": "user@example.com",
    "mobile": "13800138000"
  }
  ```

#### 12.3.2 用户登录
- 请求路径：`/mall/user/login`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "username": "user123",
    "password": "password123"
  }
  ```
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "登录成功",
    "data": {
      "token": "xxx.xxx.xxx",
      "userInfo": {
        "id": 1,
        "username": "user123",
        "email": "user@example.com",
        "mobile": "13800138000"
      }
    }
  }
  ```

#### 12.3.3 获取收货地址列表
- 请求路径：`/mall/user/addresses`
- 请求方法：GET
- 响应数据：
  ```json
  {
    "code": 200,
    "message": "获取地址列表成功",
    "data": [
      {
        "id": 1,
        "receiver": "张三",
        "mobile": "13800138000",
        "province": "广东省",
        "city": "深圳市",
        "district": "南山区",
        "address": "详细地址",
        "isDefault": true
      }
    ]
  }
  ```

### 12.4 订单

#### 12.4.1 创建订单
- 请求路径：`/mall/orders`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "addressId": 1,
    "items": [
      {
        "productId": 1,
        "quantity": 2,
        "specifications": {
          "颜色": "红色",
          "尺寸": "M"
        }
      }
    ],
    "remark": "订单备注"
  }
  ```

#### 12.4.2 获取订单列表
- 请求路径：`/mall/orders`
- 请求方法：GET
- 请求参数：
  ```
  status      // 订单状态：all/unpaid/unshipped/shipped/completed/cancelled
  pagenum     // 当前页码
  pagesize    // 每页数量
  ```

#### 12.4.3 获取订单详情
- 请求路径：`/mall/orders/:id`
- 请求方法：GET

#### 12.4.4 取消订单
- 请求路径：`/mall/orders/:id/cancel`
- 请求方法：POST

### 12.5 商品评价

#### 12.5.1 获取商品评价列表
- 请求路径：`/mall/products/:id/reviews`
- 请求方法：GET
- 请求参数：
  ```
  rating      // 评分：1-5，可选
  hasImage    // 是否有图：0/1，可选
  pagenum     // 当前页码
  pagesize    // 每页数量
  ```

#### 12.5.2 提交商品评价
- 请求路径：`/mall/orders/:orderId/products/:productId/review`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "rating": 5,
    "content": "评价内容",
    "images": ["url1", "url2"]
  }
  ```

### 12.6 收藏夹

#### 12.6.1 获取收藏商品列表
- 请求路径：`/mall/favorites`
- 请求方法：GET
- 请求参数：
  ```
  pagenum     // 当前页码
  pagesize    // 每页数量
  ```

#### 12.6.2 添加收藏
- 请求路径：`/mall/favorites`
- 请求方法：POST
- 请求参数：
  ```json
  {
    "productId": 1
  }
  ```

#### 12.6.3 取消收藏
- 请求路径：`/mall/favorites/:productId`
- 请求方法：DELETE

